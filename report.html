<!DOCTYPE html>
<html lang="en" class="h-full w-full">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Report Pollution | YamunArpan</title>
  <link rel="icon" type="image/x-icon" href="/YamunArpan.png">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    /* [Your existing CSS styles remain unchanged] */
  </style>
</head>
<body>

  <!-- Navigation Bar -->
  <nav>
    <div class="nav-wrapper">
      <div class="brand">
        <img src="/YamunArpan.png" alt="Yamuna Cleanup Mission Logo">
        <h1>YamunArpan</h1>
      </div>
      <div class="nav-links">
        <button class="btn" onclick="document.body.classList.toggle('dark')">üåô</button>
        <a href="/"><button class="btn" style="background:white; color:#2563eb;">Home</button></a>
        <a href="/report"><button class="btn">Report</button></a>
        <a href="/ngo"><button class="btn">NGO</button></a>
        <a href="/events"><button class="btn">Events</button></a>
      </div>
    </div>
  </nav>

  <!-- Form -->
  <div class="form-container">
    <h2>Report Yamuna River Pollution</h2>
    <form id="reportForm" enctype="multipart/form-data">
      <label for="description">Description of Pollution:</label>
      <textarea id="description" name="description" rows="5" required></textarea>

      <label for="photo">Upload Photo:</label>
      <input type="file" id="photo" name="photo" accept="image/*" required />

      <div id="locationDisplay">Detecting your location...</div>

      <input type="hidden" id="location" name="location" />

      <button type="submit">Submit Report</button>
    </form>
  </div>

  <script>
    // Base URL (dynamic if you want localhost + production support)
    const API_BASE = "https://yamunarpan-github-io.onrender.com";

    // Get user's location
    window.onload = function () {
      const locationDisplay = document.getElementById("locationDisplay");
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function (position) {
          const lat = position.coords.latitude.toFixed(4);
          const lon = position.coords.longitude.toFixed(4);
          const loc = `Lat: ${lat}, Lon: ${lon}`;
          document.getElementById("location").value = loc;
          locationDisplay.textContent = `üìç Location: ${loc}`;
        }, function () {
          locationDisplay.textContent = "‚ö†Ô∏è Location access denied or unavailable.";
        });
      } else {
        locationDisplay.textContent = "‚ùå Geolocation not supported by your browser.";
      }
    };

    // Submit report
    document.getElementById("reportForm").addEventListener("submit", function (e) {
      e.preventDefault();
      const formData = new FormData(this);

      fetch(`${API_BASE}/api/report`, {
        method: "POST",
        body: formData
      })
      .then(response => response.json())
      .then(data => {
        alert("‚úÖ Report submitted successfully!");
        this.reset();
        document.getElementById("locationDisplay").textContent = "Detecting your location...";
        localStorage.setItem("reportCount", (parseInt(localStorage.getItem("reportCount") || "0") + 1));
        if (parseInt(localStorage.getItem("reportCount")) === 4) {
          alert("üéâ You've submitted 4 reports! You can now claim your certificate.");
          window.location.href = "/userbdg.html";
        }
      })
      .catch(error => {
        console.error("Error:", error);
        alert("‚ùå Failed to submit report.");
      });
    });
  </script>
</body>
</html>
